import org.rookout.files.Utilities
import groovy.io.FileType

pipeline {
    agent none
    stages {
        stage('Build') {
            agent any
            steps {
            echo_all()
            }
        }
    }
}


def echo_all() {
    println("hello world")
    def list = [];
    sh "ls"
    sh "echo pwd"
    def d = new File(".")
    testsNames = Utilities.getAllDirThatMatchFile(this, 'deployment-examples','Jenkinsfile')
    d.eachFileRecurse (FileType.FILES) { file ->
    println(file)
    if ("Jenkinsfile".equals(file.name)){
    println(file)
    def dirName = file.getParentFile().getName()
    if (!(".jenkins".equals(dirName))){
        println(dirName)
        list << dirName
        }
    }
    }

    println(list)
    for (int i = 0; i < list.size(); i++) {
                sh "echo ${list[i]}"
                jobDsl(targets: '.jenkins/generate_tests.groovy',
                removedJobAction: 'DELETE',
                removedViewAction: 'DELETE',
                lookupStrategy: 'SEED_JOB',
                additionalParameters: [jobName: "${list[i]}" , realpwd: pwd(), item: i]
                )
    }
}